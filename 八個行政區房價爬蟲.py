

import pandas as pd
import requests as req
import json    
import time
#'東區','西區','南區','北區','中區','西屯區','北屯區','南屯區',
districts = ["豐原區"]






# api的網址需要手動抓下來，每過一段時間就需要更新網址，否則抓不到任何資訊。
urls = [#'https://lvr.land.moi.gov.tw/SERVICE/QueryPrice/cbf8c65f43e34cf68779a4369354e38a?q=VTJGc2RHVmtYMS85QWZZM0Y1akw4QWdNcTB5QjRkdFFpemZ3WTB0QXcrZWZJaUhBU3dqTjFzc0lUcW9jdUhkNVYrM01lK3hjdDlmYnVZOU1yb3YwekhtN2ZSd0hJU0RyOEliSXJmNUlxejhxbitvN0ZCQU5oY1QyM0hNMitFbkxReENlRFRCTW9JQ05jaFp5NGVuTVNlT0NiSzlNWG1MMkxPNmE1dlBrZTFBQW0wVWRyRk8rUlRaZlkxOUlneWRkRjU4bGxwWXdldERxMEU5ZjViTnMxdXQrcmQyVnh1NlQ2TFdsU3hVR3ZCUytmZ1dIYzJwS2tqZUc0eHlmditKSjVuNjk5NWRkZGJEb0F6NUtyNm1jRWY0VGdSRi9pSlpVaDNOU2NLK09lZjB4Y2pUckhHaEVYelhVSjZZbFhMa0VEdEYyMWlEdndzb2FlS3VGcGZENGNaWVgwOUEwdkdKVHFpbmNJTGFVa2NGQy9xVHpzSm9RZjk4QW9nY3RMZWZxdWxySHBQZ0pYdTVPMjNRNlpmVFI0Q0JIWkNPZTNVTWJERmllRlhmRkZrbTJXRnptaUc2S0RUR3lLbytpcUFmenNCdlYrbkpNWjZ0WXFzZG5IV1dqekx2QjRsMmtGcmlJNHBTaHRJa3VHaWVnUERobjdBZWxyYytBVkRyaW5YTHhqaTlzVEwrOS9wcXR6SHlXWWUycEhZZ0NJaEhITWdiS3EzeDJJMy9CejJOWXBRRlo4bFhRa2hnb0QyMWN2UG9KTkZYYjA5clVPdjRGYWJMeTFibzRsUFNJZ2tYdlA1b2twTkt4dThubnMwZzcxanRNMFVDczdDN01xdnIzTitOZGg1NlptN3ppTG5MdCtWaUtQZHV6M2Zra0NmWm1jQ2VwakdYYzUwSGMyams9',
        #'https://lvr.land.moi.gov.tw/SERVICE/QueryPrice/e4c80461130680872bf645861e271493?q=VTJGc2RHVmtYMThwck5NZkp5U0JMNm1MZHE5eTdWY0plZmFWRzk5bjlKOXBYQ3VOTXdHUzhxNm5iZ3RvdE9tV09aTmN4Y01WdndqTTI4OTBSMTdubWdyZWVRM1MybkZ1NjY1MUJZc003MUZIdXhURmIzUWNUelhRaEYzMkgyTUZXZUZ0S25LemcxQ1Z0SDFMMW9SNHRBNUkxTDM5SUF1TDREaUp5WHVJc3Y0RjZiSnZuSDI1QXZ5Z0JySjYzV1F6YWN0Y0Z5SFNEU3I4VlZWcGtidEJRU0hzb09VdGp2WklsRWovRDEzTmtLVHUveGxzaTJZT05DLzFMaVppWFBpWEl2cWJFb2ZYM25CWk84RjhWVjR6Y0lRT1d1NTlsT3JURVNUUDFBdUNRVGRvdkZNNlJuNU0venZrZUxiNWlXQmk1NjVhbVZLK0RVM2cxV2l0OGV3RTBpa2RRRVBleTFIZkUxRDJuV2FMSFBoMWVkdFFGcXhyN0lxRXBSdWlPTE5rOS9CM2cwT0E4WTcwWDZGNlpaTnd3WHc2MEl3ZHBNY2o0R1Qrd20xNU41V3A2TWdJbDZiQjBOYXlnT2tFdW5aY0dTM04yVVJGVFZOaGU1Qm8wVUdwRS9pRENvSjJSdG5OV1hrTzNpUGJURURUTmtMZEh4L1ZmdlZQRjlsR3k5ZTN5WmxZbzE2K2lYMmtybWhDeEZoVnNRcFd4SlFrSHZxeldaUHJXa0tBL1NyYkNnSi8rRlRiZFNaRlFuYWU4bS9TeGhVOS8vZ1NHdmRMUFVOcXFIbjE2MTFIcUk3QzM5SEROcjVBcHdGVHFFcFhxSGJQdnhkZEkzUXpqcVloMkJLWXQ5WjZGcldBM0NISVdDcDNuREZ3T3MrNnRzeTV4Mlh1WUR5N3VBZEFTa0E9',
        #'https://lvr.land.moi.gov.tw/SERVICE/QueryPrice/41786953e36e5a01ba5413c7ad482be0?q=VTJGc2RHVmtYMStqUnVpWUtQa3dNNlZUR0p0b1dmTy9rdjcvMlBpdU9BVGhTRkRzTG9PQlYySDhwaUw3T3I0NStBbU1lRDNVZThkbkN5SnpoaHZvYkkzS2NKTkFqbDdGQ2s4WWZGdXlRK00vbXNwdElQWFB6ME5jbExRVjliajVKeHhTVnF3T0lkV25VQXZpWXVPVnlucUpPRkt4eFNUKzVCbnhoNjQyaXJNejJkKy9ITEFDSm9SOVZsVUVjbmt5MWE4WEM2Nzc3V3NCdXVYVlE2TDR5dXFObDFVYjBOVEJkM1NwcnBRU2w4QiszOTI1d2kxTXpQSDZkL3FOR2c0TmVtK3hUM2lEbEJrR3ZZRWU2SmNqL090eHFuaW5EYnYvSk5MOHZQaG5YaXFNQUVvSTdIc21WQ3JBRGNLQ2pBdDZaMXlMK3lwNk0zZG5QVUFZRCt3UWNkMkI5aHdDemxsQ0RRbVdMSDZ3KzBIdGw3aC9zSFR2VDFmNnJHZ3lxS0hCSzNvRThFVldUSi83R0JoRURFWE5hc2JMM1hLdEs5OGt5Y1FpWUJMelBkcTJLbEN0S0w5ZklHZ2tzVGhMZ1YwUE9oYnhWUWJEOUhDTEFRdXVRNlVGZjA1TlpmbWF3T0pGVmNTSUErLzUycWJDTkgzalJKN0kwa1VrcmJsUWpPOWtJTUh4TmYyYVVidXlkRmRrRlNmWU56b1k5bDU1VHRnNjZQZ1ZSczdETWNhZnRjWkdOQm5ha045OVRmUmtYbk53VFdjdVhkb1M1dHRERkZvUTRSYTNDVVVZSjhXWGorVkZURkRGejF3azR1RXBtZzdOaW9KTTdoVzFnSWp4V0JxeGF5QVJLT3dNb1VhY1VLcmpZV2FZYUtsOU1rYUhFYmxxNk9MVWN1Q0V6TEk9',
        #'https://lvr.land.moi.gov.tw/SERVICE/QueryPrice/835f416aea32e04ae967e149a2c83269?q=VTJGc2RHVmtYMTh5bkdlNUlEdzIyd2F1UVYyUzJOai9GUjZObFh0ZnZ5S1JIVkd2TW53RHRlUEZRd24wcHRHZ1Rxblk0cFM4UlAxTFhnTmRzU05uZGgycGR0Ym1ZNjE4clhNYitzZmdFeHRqTVM4NzJrVkdTZnJ6VVhodnRFQUxXN2p0TGUrbTRKNkdzS1BZUksxdlo3RjUva2Y2Qis1VkpOMVJNYUpnU3ZDbE5EWTdITjRJckZyNVpEZWlCbDhZa0NCQXBnNUJKYXBYYnkyRW9rSTg2TVJXNFBIaUxXdXRDMFd6RU12Z0dXVEx5ODkxTC9jVFhhcktUQ0VUU0ZZVUFEeDdROFVhRHVEdzZZYVRqcjBPU3N5djBCamN5YVdQTUlTWnBjbkJNRzBOQTVOemxoUkdhYkFadUUyZmJDajNhZHBDeXpyeHNvak5MWkE3Qmhua2Jxc3lMUGpNcVhncmd5L0g2eW5yMzhEWXo0Q000VEorc1pYYjFvNngySXYxbFFPZWJqNmFVb2dpbEd2K2JmNTBpb2xvS1ZLRHp0dDhTTXluT0k3MERoMGZqUVNNbDJRaHJ0ZkF0S28xdy9XOEhsaGV1ZjFVTysyMXBCc0t3djRWeXlsZU9yenVJUTlHWDA3b3BPUU9vYXJkYzA1bTBvamZKR3o1dm5DTDYvRkdIeVBuZEtkU1NuYWxYUnpUVnd0RC9XaWRnVmloVXViSUdvd3NmTEdKU0hLWE5hRGRMYmxBSWQ0M1NKTmQwdk9KenZUdFg0N2x5ODZac29MTkE3RDEzMkVBZE8xc1k3SWppb0FPT3ltRm8zS3Y3R1NZd0YvL2RXcm9MYjViV0E5VnNBQnpscE1uNTN6WTVDSkNQZlhrZWNsTDBGNVZkcUh3MjJMempXSnAyTTA9',
        #'https://lvr.land.moi.gov.tw/SERVICE/QueryPrice/9305ef75d189e28a5536edac537dd959?q=VTJGc2RHVmtYMTgxUmNJUTUxNXZpcWM5NUVPWnBVZHJCaWtQRm9NSHNCU205eDlhejNIUUtHY0lIa1JRdWkydnhYalQ0TitGb1V4UmRyOFltckd3d3F6OGRFbWthRFFGSElzaHNWZlBSMWpDVDZKTlBreUFQRHFnS1JEYkxqQzNTY2Q1a20vL0lyOFQyMmZzT2VIY2g3eDVCbEx0UkhYREgwQ3NTaUYvazhVT3REdU4vRDZJWjZHYTA4VnBJNVFLT1pYcWYvK3pkUWtSdUJpVDk5YU9rNGRPYU9JcjJhYm9GY3c5TmtqRi9JaFF4bytmWUZ3VDZ0Q1pMd0Jndk5FeGN1dnZwRXEvenRSZXdaVUxYOGxNT3JraXVaNjZzOXVXMTZHamRzR0diaTQwYnprT2crODZRbzYwZHBKREJydjJielpkMDRiSlQwbFRxRXNiWFRUQjk3c0FYVE9vYkEwdXRudGZob0VLeXdFamJNVmczbFNRTVlsTTRxN1dGbDExc3ZSa1JhQkYxSEtnZ04yWDV2Y3FYalVlbEVjcjh4U3RaMU1rWDE4Wldsdkcxcm5jMnpTRm5LYUQvajZnRWZjc0s2UlEyLzZsZXh0ZE9NMFdESDNhTEplYnNPNlFCMTE5VDVLcVoyZWU3NVU1THV2WXkxMk9lYzE2SG1lc3lLM2xmOUdJWkJrOE9md3EzLzNsSkdoTnlOS256VFNXUUF3NlhsVWtsT0NPUk9OZHp4bEM5MmlLb1lkVEh4QVc3S3ZJZUF3aUJ4bDI5YUkzSWFVZmtMdHFQT0s3S2hTZWQ2TEJ3emVtUE81KzhQWCtZWGZJM3JjdjdJTlRDdjVBQXhZYUNkUFJhcVJWenc5L3hYeUFjRDJnNmJSQnkyRDBwUDRyMlBTTXVwYisxVUU9',
        #'https://lvr.land.moi.gov.tw/SERVICE/QueryPrice/ac99f12046f92c16d1535fd449acc96b?q=VTJGc2RHVmtYMStlczhVS0hNUm04UVd3Z2gvRW5SS1A5ZFdXQnI0YnJsb3BITnJ2ajkrMmMxVE5SaWwyQ01ybHV5UG4vbFZVUDRkd3c5TElHVVR6WGwwSEQwdENLYXhKMWhtc1VrRDRXTlJsQ0Rtb1dFUXRvODJnVSttYUFqazNhZUhXRDZFd1VmYVpCMUNyU2liRVpRVGxETWhlMk1lVmgrUmVjeEcvWGtlTlJsNHFWZHlIdVdhdGFncXhIUS9WZ2pOQmxmMEdxUkt1UjY0d1o2WUkvdGxoSkZuQUZJMGlLY1FHUFZkd1RwNlMzWEk5VC9EWWN1VlpJYy9adzkzRC9rRmErU0dOa21zWExpQ2RFS0o5MzBzUXgvUDN1Z1hQSnpZbFNzU2M0UEdZRWJsZHRmQjRZcE1pNXFwSUFzOFpsZ3VqZnpnUTRkS0VLcVZCQmJBQ1Bvd3hqNnlEVjNIcUlxQW5JUjhDTWZockYrVWk0Z2ZBNkVQVi9pWHE3QWxCTWpRQmtQOW9nREZMckdLOUVTVzR6OE1DOW5wMGpFclcraWhvSFYzeTc2OG9rYzJjdHZLb3VQNG56MEpZU29MU2xTMStscjBkb01CNmNSc285MTN1SUs1Wmh4bUZxeFBRVXEzTTRna1VORDFuTmF4a3NNNkFsdWxyVUxkNnM2SVc3bWNGUm54Wkp1NDZmT09QSm1wOXRGbDAzcFBGaEN4U1EwcjI0aDd2SklwZ0V3VWw0QWptUHNHWWNUU0NsQjd4MmEvc0JxWWtyZEhXYWI4T2NsK1FGS2ZyNGRtamlHc2RsTmhkVVhyU2o4enYrcWNWZUxjM3FUeEJSa3haQ2ZwTU0zb3VqVlJaVWNXcWFuTWFEWlZKWjVZYmtyQjNrNTl3blMzS2pLQW1vMzA9',
        #'https://lvr.land.moi.gov.tw/SERVICE/QueryPrice/1b91e571cb8b35871a6fbec0b803534a?q=VTJGc2RHVmtYMStnOFFYdXBFREVJZ2ZaNnkxWUczQ2ZpOFgyQ1BVMzliYTM5MUdIUTVrQllOZmVHVTZ6NGZaUTN3SzF2UWN1bUMzL0tRN0pPR3ZVTzN4cjlVR2xiRUZpUEVIT2UwdnEzUXNiOUZFWi81Rys4anc0VTRaaTVqd1FyWkdiOHB3V21XWnRCK01Lc0liNXFEazhyMkRPV1JPUkJGeGg0OG85b0tFMW11L1ZYQmx3OU1ZWEJ2SkRTN3NHRitWR24zTHQ2T2pHWERjbUJLOUkvOElWNEZnZG5hcXMraTdEVFNYUTR5MmFVdlo0eVlBcXMrRzM5U1A2ZGxYLzR1YW00MUc0Nk5KckRLbk9XRnhNU292b3c0ajBwUmJsMmIwbTFDNldzckdIaXcwTC9oVjVqVWh2dTRkUFNOTHpYZnNMQ2NzQUFHd3MwSmxlMDR2MEJoT2FQOHF3QVdSVTB4MThLbXFJUm8ydDVMSzN0Vnc1aEY5TklEZ0xNc09XY2JUeFdFQk00NzBhb3NvUVRWS000bkNUdk1ZQzNRekRkN0ZSNG5ZclVUVVI3dHJvU2xkTnd4c0xsdE52cGZ1dWFqS1BYa3lrMlJXSWZVYnpkMG9XTlVoNWZZdHU0OURwNE1BOWttd0ZHKytkdy9rUENURm1YSVgzdlpEaXJKclMxM3FIYnpYYzRrRjZTY0VNeWRpWllXOTlTaWw1NXovVGZDSmo0Y01ZSTcrVkJ2M2xjZTd1N2REOVo1NTFnNmdMUVpMQlhKWEVCaDFHQTE5aDhoVWhxYUlYVU5iYzIxeHRvaFI5MkxuaS96bzRYSzVLRytsRHduTjl1NUpkTWhJbXhOcHpYTlZKREV0Z2U5eHlNVXBoRzV3dEVsZ2lrK3VrV2l2MUhuMkt5dmM9',
        #'https://lvr.land.moi.gov.tw/SERVICE/QueryPrice/fda1251814402343ff40c63f2dd7bdbb?q=VTJGc2RHVmtYMTl1R2lZNDdkbDFaRWFMWlZ2ZCt5LzRodnBTMGg2dmhlRzM5eDlrYUh6cUx6bVJOSXRQYmo0S1ZRQldselM4ZDBucWMwQjRwanVLcEJLeExERGczR1g4ZWI5UjRRNy9TQ3JYdm5QQmpUajFTbE9pTDdDaHVFSlBrdDY5NmhSN3kwZXpqSW11L2R2UERuQXcvVzlqZ1hoSjRCY2I5c2hoampYdStBbXp6QTdSRU44YnRKSFliYWZXQ1kzZkV5cnBTYnZqKy9hdlpuSlY4MXB3RXNaQ25ERm9nMG9Rcmp0NUd6YzZ6WG5RdlQ4NGZEMFdOamtsaG9mNkRONmtEMzIveFgwZWN6MTIwNkpRclRHaHd3UjFOc3Brb1NLMnNjejJvM3V2dVUrNTNVUUZIN0Z5QUtHK05IQ2RKTEZpVE04U0JxVFp4czFqRnZxREVpVDIxWlIzVklMNzZxWjNuNVlQeXRJbHpaRHptdjc3a25xOUh1c3h1RktkbnZpZ21XYkZkeVlrNUY3N2NXMldNNzZNV3k5d3o4ai92Z3JGWEpwc09KQ2YzazRaV1Y0MDVZWWhvalBPN3BCQ01FN2lGWS9ENjlBbUtpSUl2TkZIMCtya0JOc1FaS1hxU2tkaEFOY1Z0cllSR2llbys4NVhjQmtvTjRFSldtTEpXcWp3YnpGd080a1ZnVnF1NWJRWjUzeEVLOUFPVmlTempsamtjbFh3N3VTZ0FhSjRoYzFQVTdrbTNiSHJERGZqTnJiU2hjbmxPdUt1SGI2U2hqWVNnNlduUklYNkhsNE55VndjUmZBWWptUmthcUtWZW83aE40RGhlRHpUcnpXKzNzUVhPenJvOVlvdlE4cXlYYkZ1cWVJK2VhS25BYU9LeE0rbTd2VUg1TWM9',
        'https://lvr.land.moi.gov.tw/SERVICE/QueryPrice/16ec04186ae5b3e72cb9498062f82e2f?q=VTJGc2RHVmtYMThtR2FxaUhwNk1oMkhXenVobVJML0hiRmVIbWdRYzg0NVI3K1ZxTkdtRGprR3NPOFVaR2E3Szh6Z1hrM1p5SjMwMmtENWlnb05QYnNPUFQvZW9weUt5Q2MzQTdvMllYQ1NhZVI4OXBzc055LzFKVkkzZGh3ZEJSWmhYeENjMXdYUnM5aTJhMURnTXEzZ2ZObGVFd1N0UW9FU0V5dElvSCtpQ1ZhWk1SWDZvZkFCRXNiNGpsRHpJK3RabXhPcUNaeDFmS0tPakMzZ2VuMnV2N1JhY0hmMzRjaUhNdG81TXBmejN0U1d4cHRpS2JLM0h3WkNKdnlqY09uaVJxcGd6YnhxNFBaeGNhSXhLdUhWNUE3S0RiSnY4eHowTkcwS1VnL1phUlVDYnVLejBocGN2ZFJ1dTY2RDhRcDVuZjI0TTZucjNyVDNHYm5Ja1lwaWx1bUVUTzB0d0RPWEMyd3RONzNnVTlmZWhnTWVYU0hYelFGREFZNVdsbS91YUVoeGhuS0xKNEtQaHNFK1lic096MWE2UFQ0VE5sS2hBdmh5UXFpK2RuQkZiNE5DdmZDaFR0S3JONTBwNHk4eC9QMHQxaktaZm9sckl3eE5jajBvNytlQ056dnVhcGVQMENaZ2FCd2RuRGl6UExRblBKWXZ1YWlKZFJiK3N5Q2JxNkV4aCsxLytrK2RsSFh3OXJGSFVHN2JRS1NPdW9GQkxUa3Q4THgyWnZsd21Sc3JPWllGT0hlQ1dWZUE4VThRT1dTbGZQL0RnRURMcnhRdUVVd1JRYWZBYXk1eWVDNmJiSWZpTXpQekFocnd1RFg2SjRTRmtwSUt5V0hWOWxoOFFzeUV4dDNQS1hrN21INVFGR0ppa1pQeVZiWlVSN3BPZ0VmalRETG1LeTVjdU0wSzNxTWRtSVd6cGVLc05QbkNDbEpYYUlwb3VCM2FnT2xkSEljTGx6d0FmVDU3b0hyTitlZmhhaDY4PQ=='

        ]

df = pd.DataFrame()
#for i in range(0,8):
for i in range(1):
    print('正再爬取 「{0}」 112年7月至113年7月的資料'.format(districts[i]))
    resp=req.get(urls[i])
    data=json.loads(resp.text)
    print('一共抓到 {0} 筆台中市{1} 112年8月至113年7月的資料'.format(len(data),districts[i]))

    house_object=[]
    for object in data :  
        one_object={}              
        one_object['經度']= object['lon']            # 經度
        one_object['緯度']= object['lat']            # 緯度     
        one_object['屋齡'] = object['g']             # 屋齡
        one_object['面積'] = object['s']             # 面積    
        one_object['建物類型'] = object['b']         # 建物型態     
        one_object['用途'] = object['pu']            # 主要用途    
        one_object['樓別/樓高'] = object['f']        # 樓別/樓高   
        one_object['佈局'] = object['v']            # 幾房幾衛幾廳
        one_object['電梯'] = object['el']           # 有無電梯       
        one_object['管理員'] = object['m']          # 有無管理員          
        one_object['車位數量'] = object['l']        # 車位數量   
        one_object['成交日期'] = object['e']        # 成交日期   
        one_object['價格'] = object['tp']           # 價格
        house_object.append(one_object)

    #--- 將原始數據保存到 CSV 檔案
    cols=['經度','緯度','屋齡','面積','建物類型','用途',
        '樓別/樓高','佈局','電梯','管理員','車位數量',
        '成交日期','價格']
    df_house = pd.DataFrame (house_object, columns = cols) # 將list 轉換為 dataframe
    df_house['行政區'] = districts[i]
    df_house['交易年份'] = df_house['成交日期'].apply(lambda x: x.split('/')[0])        
    df = pd.concat([df,df_house],axis=0)
    time.sleep(5)

df.drop(['成交日期'],axis=1,inplace=True)
df = df.reset_index(drop=True)
print('完成')


df.to_csv('豐原房價.csv',index=False)
